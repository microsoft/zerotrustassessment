---
author.spec: tygrady
author.doc: 
author.dev: kshitiz-prog
---

# On-Demand Scans Configured for Sensitive Information Discovery

## Spec Status

Completed

## Documentation Status

Not started

## Dev Status

In progress

## Minimum License

Microsoft 365 E5

## Supported Clouds

Global

## Pillar

Data

## SFI Pillar

Protect tenants and production systems

## Category

Information Protection

## Risk Level

Medium

## User Impact

Low

## Implementation Cost

Medium

## Customer Facing Explanation

Organizations with large volumes of historical content in SharePoint, OneDrive, and Exchange that predates auto-labeling policy implementation lack visibility into the extent of unclassified sensitive data across their tenants. Auto-labeling policies only classify new and modified content going forward; existing files and emails remain unclassified and invisible to data loss prevention policies that depend on label detection. Without on-demand scans, organizations cannot perform a baseline assessment of sensitive information already present in their environments, making it impossible to quantify compliance risk, plan remediation, or validate that DLP controls are effectively protecting all sensitive data. On-demand scans allow organizations to manually trigger sensitive information type detection across specified SharePoint sites, OneDrive accounts, and Exchange mailboxes, identifying where sensitive data exists and enabling targeted classification through retroactive labeling. Configuring at least one on-demand scan enables organizations to discover and classify historical sensitive data, providing a comprehensive view of their information protection posture beyond the forward-looking coverage of auto-labeling policies and creating a complete baseline for compliance and risk management.

## Query Prerequisites

**Required PowerShell Modules:**
- ExchangeOnlineManagement v3.5.1+

**Required Permissions:**
- Compliance Administrator, Compliance Data Administrator, or Security Administrator role
- Organization Management role (Exchange Online)

**Connection Requirements:**
- Connection to Security & Compliance Center PowerShell: `Connect-IPPSSession`
- Requires internet connectivity to Microsoft 365 services

**Notes:**
- On-demand scans are distinct from auto-labeling policies; they are manual discovery operations that scan historical content
- Scans can target SharePoint sites, OneDrive accounts, and Exchange mailboxes
- Multiple scans can be configured, each with different scope and sensitive information type targets
- Scans can be run on a scheduled basis (recurring) or as one-time operations
- Scan results are available in the Microsoft Purview Portal and can be used to inform labeling and remediation strategies
- Scans do not automatically apply labels; they identify where sensitive data exists for manual or policy-based remediation
- Large tenant scans can be resource-intensive and may take days or weeks to complete depending on data volume

## Check Query

* Query 1: Q1: Get all on-demand scans configured
`Get-SensitiveInformationScan`

Documentation: [On-demand classification in Microsoft Purview](https://learn.microsoft.com/en-us/purview/on-demand-classification)

The cmdlet returns all sensitive information scans configured in the tenant, including those that are scheduled, in progress, completed, or waiting to run. This provides a complete view of scan configurations and their status.

---

## Technical Note: Dynamic SIT Name Translation

When `ItemStatistics` returns SIT GUIDs, the assessment tool must translate these GUIDs to friendly names for user-facing output. Rather than maintaining a static hardcoded mapping, this spec uses **dynamic discovery** via `Get-DlpSensitiveInformationType`:

```powershell
# Build SIT GUID-to-name mapping dynamically
$sitCatalog = Get-DlpSensitiveInformationType
$sitGuidMap = @{}
foreach ($sit in $sitCatalog) {
    $sitGuidMap[$sit.Identity.ToString()] = $sit.Name
}

# Translate GUIDs from ItemStatistics to friendly names
foreach ($guid in $itemStatistics.SIT.PSObject.Properties.Name) {
    $sitName = $sitGuidMap[$guid]
    $matchCount = $itemStatistics.SIT.$guid
    Write-Output "$sitName: $matchCount matches"
}
```

**Benefits:**
- **Zero Maintenance:** Automatically reflects new SITs when Microsoft releases them
- **Resilient:** Uses official SIT catalog as source of truth
- **Accurate:** Includes custom SITs created in the tenant, not just Microsoft-provided defaults
- **Complete:** Handles all SIT types without manual list updates

This approach eliminates the maintenance burden of updating a hardcoded GUID map whenever Microsoft adds new SITs to the catalog.

* Query 2: Q2: Examine on-demand scan configuration details
For each scan returned from Q1, examine the following properties:
  - `Name` - Display name of the scan
  - `SensitiveInformationScanStatus` - Current status (NotStarted, ImpactAssessmentInProgress, InProgress, Completed, CompletedWithErrors, Paused, Failed)
  - `Workload` - Which workloads/locations the scan targets (SharePoint, OneDrive, Exchange)
  - `WhenCreatedUTC` - When the scan was created
  - `LastScanStartTime` - When the scan last executed (if applicable)

If at least one scan exists in the tenant, on-demand scanning is configured. Note: Scan status may vary; a configured scan can be in any status (not yet run, in progress, completed, or failed).

* Query 3: Q3: Get details on specific on-demand scan
`Get-SensitiveInformationScan -Identity "<ScanName>" | Select-Object -Property Name, SensitiveInformationScanStatus, Workload, ItemStatistics, LastImpactAssessmentStartTime, LastScanStartTime`

Documentation: [On-demand classification in Microsoft Purview](https://learn.microsoft.com/en-us/purview/on-demand-classification)

This query returns detailed information about a specific on-demand scan including its current status, target locations, and sensitive information types matched. Review `SensitiveInformationScanStatus` to understand the scan phase (ImpactAssessmentComplete = estimation done, InProgress = scan running, Completed = finished), `ItemStatistics` to see which SIT types detected content and match counts, and `LastScanStartTime` to confirm when enforcement scanning last performed.

---

## SIT GUID Reference

**ItemStatistics Property Format:**

The `ItemStatistics` property returns a JSON object containing SIT GUIDs (not friendly names) with match counts:

```json
{
  "SIT": {
    "50842eb7-edc8-4019-85dd-5a5c1f2bb085": 2,
    "a44669fe-0d48-453d-a9b1-2cc83f2cba77": 1,
    "d3515d47-d117-4910-bc05-824519861cf2": 5
  }
}
```

**Parsing & Translation:**

The assessment tool **must** translate these GUIDs to friendly SIT names for user-facing output. Use the following reference:

**Common SIT GUIDs to Friendly Names (Core Financial & PII):**

| GUID | Friendly Name |
|------|---------------|
| `50842eb7-edc8-4019-85dd-5a5c1f2bb085` | Credit Card Number |
| `a44669fe-0d48-453d-a9b1-2cc83f2cba77` | U.S. Social Security Number (SSN) |
| `ed36cf51-9d63-40f3-a9a6-5a865c418d21` | U.S. Bank Account Number |
| `48ee9090-3f74-4238-89c9-6c0a93767a8f` | SWIFT Code |
| `50f56e32-3a6f-459f-82e9-e2b27b96b430` | Drivers License Number (U.S.) |
| `65ce4b3d-79b3-46c0-ba9d-8226d98130c8` | IBAN (International Banking Account Number) |
| `3b35900d-fd2d-446b-b3ad-b4723419e2d5` | ABA Routing Number |
| `f3dbc5dd-e2d4-4487-b43c-ebd87f349aa4` | Canada Social Insurance Number |
| `f87b75b6-570d-465d-a91a-f0d9b9e0b000` | U.K. National Insurance Number (NINO) |
| `b3a2fd72-cc1b-40fc-b0dc-6c5ca0e00f6f` | International Medical Record Number (MRN) |

**Full SIT GUID Reference (For Documentation Only):**

The table above provides a reference for common SIT GUIDs. **In implementation, use the dynamic catalog lookup shown in the Technical Note above** rather than maintaining a static mapping.

For research or documentation purposes, Microsoft publishes all available SIT definitions:
- **Source:** [Sensitive Information Type Entity Definitions](https://learn.microsoft.com/en-us/purview/sit-sensitive-information-type-entity-definitions)
- **Format:** Each SIT definition page contains the Entity ID in XML (the GUID you need)
- **Example:** [Credit Card Number SIT Definition](https://learn.microsoft.com/en-us/purview/sit-defn-credit-card-number) shows Entity ID: `50842eb7-edc8-4019-85dd-5a5c1f2bb085`

**Implementation Guidance:**

1. Use `Get-DlpSensitiveInformationType` to build dynamic GUID-to-name catalog (see Technical Note)
2. Extract GUIDs from `ItemStatistics.SIT` object
3. Look up each GUID in the dynamic catalog built in step 1
4. Replace GUID with friendly name in user-facing output
5. Display as: "[Friendly Name]: [Count] matches" (e.g., "Credit Card Number: 2 matches")
6. If a GUID cannot be mapped, display as "[Unknown SIT - GUID]: [Count]" to avoid silent failures
7. Note: Custom SITs created in the tenant will be included automatically in the dynamic catalog

**Notes:**
- ItemStatistics is updated in real-time as the scan progresses
- GUIDs are consistent across all Microsoft 365 tenants and never change
- Custom sensitive information types have unique GUIDs; the dynamic catalog includes them automatically

---

## User facing message

Pass: At least one on-demand scan is configured in the organization, enabling discovery and classification of historical sensitive information.
Fail: No on-demand scans are configured in the organization; historical sensitive data cannot be discovered.
Investigate: Unable to determine on-demand scan configuration due to permissions issues or query failure.

## Test evaluation logic

1. **Build SIT Catalog:** Execute `Get-DlpSensitiveInformationType` and build dynamic GUID-to-name mapping (see Technical Note above)
2. **Query Q1:** Execute `Get-SensitiveInformationScan` to get all on-demand scans
3. **Count Scans:** Count the number of scans returned
4. **Evaluate Pass/Fail:**
   - If count ≥ 1, the test passes (at least one scan is configured)
   - If count = 0, the test fails (no scans configured)
   - If the query fails or cannot be executed due to permissions, mark as Investigate
5. **Translate GUIDs:** For each scan's `ItemStatistics`, translate SIT GUIDs to friendly names using the dynamic catalog built in step 1
6. **Note:** The test passes regardless of scan status (NotStarted, InProgress, Completed, Failed) as long as a scan is configured

## Test output data

The test will output on-demand scan configuration statistics:

**Exact Output Table Format:**
```
Name                          | SensitiveInformationScanStatus | Workload         | Sensitive Information Types Detected   | WhenCreatedUTC      | LastScanStartTime
------------------------------|--------------------------------|------------------|----------------------------------------|---------------------|------------------
FinancialDocumentScan         | ImpactAssessmentComplete       | SharePoint       | Credit Card Number: 2 matches         | 2024-01-15 10:30:00 | (empty)
HistoricalEmailScan           | InProgress                     | Exchange         | U.S. SSN: 1 match                      | 2024-01-10 08:15:00 | 2024-01-24 09:00:00
```

**Summary:**
* Total On-Demand Scans Configured: [count]
* Scans by Status:
  - Completed: [count]
  - In Progress: [count]
  - Not Started: [count]
  - Failed: [count]
  - Other: [count]
* Locations Scanned:
  - SharePoint: [Yes/No]
  - OneDrive: [Yes/No]
  - Exchange: [Yes/No]
* Sensitive Information Types Covered: [List from scan configurations]
* Most Recent Scan Completion: [date]
* Status: Pass/Fail/Investigate

Link to portal: [Microsoft Purview Portal > Information Protection > Classifiers > On-demand classification](https://purview.microsoft.com/informationprotection/dataclassification/colddatascans) or [Microsoft Purview Portal > Data Loss Prevention > Classifiers > On-demand classification](https://purview.microsoft.com/datalossprevention/dataclassification/colddatascans)

---

## Check Results

**Result Summary:**
- **Pass:** At least one on-demand scan is configured for sensitive information discovery.
- **Fail:** No on-demand scans are configured; historical sensitive data cannot be discovered or classified.

**Expected Details:**
- Total on-demand scans configured: [count from Q1]
- Scan names: [list from Q1 Name property]
- Scan status breakdown: Count by SensitiveInformationScanStatus (ImpactAssessmentComplete, InProgress, NotStarted, Failed, other)
- Location coverage: Review Workload property - SharePoint [Yes/No], OneDrive [Yes/No], Exchange [Yes/No]
- Sensitive information types covered: [Friendly names with match counts, translated from ItemStatistics property GUIDs using dynamic catalog lookup]
- Most recent scan/assessment: [Max/latest date from LastImpactAssessmentStartTime or LastScanStartTime property]
- Historical data discovery: [Enabled if count ≥ 1, Disabled if count = 0]
- SIT Catalog Source: Results reflect current `Get-DlpSensitiveInformationType` catalog (includes Microsoft-provided and custom SITs)

**Portal Link:** [On-demand scans in Microsoft Purview portal](https://purview.microsoft.com/informationprotection/dataclassification/colddatascans)

**Remediation Steps:**
1. Navigate to Information Protection > Classifiers > On-demand classification in Microsoft Purview
2. Select "Create scan" to begin configuration
3. Choose target locations (SharePoint, OneDrive, Exchange)
4. Select sensitive information types to detect
5. Review Impact Assessment for estimated scope
6. Schedule or start the scan
7. Monitor progress and review results

**Learn More:** [On-demand classification in Microsoft Purview](https://learn.microsoft.com/en-us/purview/on-demand-classification)

---

## Challenges

- **Scan Duration and Resource Impact:** Comprehensive baseline scans on large deployments (millions of files in SharePoint, OneDrive, and Exchange) can take weeks or months to complete. Scans consume significant tenant resources (compute, storage I/O, network bandwidth) and may impact user productivity. Organizations must carefully plan scan timing and scope, often starting with high-priority sites or accounts rather than comprehensive scans, which limits initial visibility.

- **Detection Accuracy and False Positives:** Sensitive information type detection depends on confidence level tuning—low-confidence settings generate excessive false positives (e.g., sequences matching credit card patterns but not actual numbers), while high-confidence settings may miss real sensitive data. Trainable classifiers add complexity, requiring high-quality seed data and iterative training to achieve accuracy. File type variability (documents, spreadsheets, PDFs, images, encrypted files) affects detection performance, and some SITs perform better in specific formats.

- **Results Triage and Remediation:** Comprehensive scans of large environments generate thousands or millions of findings, creating an overwhelming data management challenge. Organizations need robust processes to prioritize findings by sensitivity level and location. Beyond triage, clear remediation policies are essential—without defined approaches (retroactive labeling, DLP policy enforcement, access restrictions), scan results may not be acted upon, leaving discovered sensitive data unprotected.

- **Operational Constraints:** Organizations with litigation holds or strict data retention policies face constraints on scanning and retroactively labeling historical content, requiring legal and compliance review. Multi-tenant environments and federated identities add complexity—coordinating scans across tenants becomes operationally difficult, and fragmented discovery results reduce visibility.

- **Scan Schedule Optimization:** Determining optimal scan frequency requires balancing discovery completeness with resource impact and organizational change patterns. Too-frequent scans risk performance issues; too-infrequent scans may miss new sensitive data. Finding the right cadence depends on data growth rates and risk tolerance.
